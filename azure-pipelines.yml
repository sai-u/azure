stages:
- stage: PackagePublish
  displayName: 'Package & Publish'
  jobs:
  - job: PackagePublish
    displayName: 'Package & Publish'
    steps:
      # - task: Docker@2
      #   displayName: 'Login to Artifactory - Dockerhub remote'
      #   inputs:
      #     command: login
      #     containerRegistry: sampleapi-dockerhub-remote-service
      
      - task: Docker@2
        inputs:
          command: 'build'
          Dockerfile: '**/Dockerfile'
          repository: 'colesgroup-jfrog-source.jfrog.io/share/python-pipeline'
          tags: |
            20221201.5
            latest
            
#       - task: Docker@2
#         inputs:
#           command: 'build'
#           Dockerfile: '**/Dockerfile'
#           arguments: '-t colesgroup-jfrog-source.jfrog.io/share/python-pipeline:latest'
      - task: ArtifactoryDocker@1
        inputs:
          command: 'push'
          artifactoryService: 'coles'
          targetRepo: 'jfrog-source'
          imageName: 'colesgroup-jfrog-source.jfrog.io/share/python-pipeline:20221201.5'
          collectBuildInfo: true
          buildName: 'cleanup'
          buildNumber: '2.5'
          includeEnvVars: true
      - task: ArtifactoryDocker@1
        inputs:
          command: 'push'
          artifactoryService: 'coles'
          targetRepo: 'jfrog-source'
          imageName: 'colesgroup-jfrog-source.jfrog.io/share/python-pipeline:latest'
          collectBuildInfo: true
          buildName: 'cleanup'
          buildNumber: '2.5'
          includeEnvVars: true
      - task: ArtifactoryPublishBuildInfo@1
        inputs:
          artifactoryService: 'coles'
          buildName: 'cleanup'
          buildNumber: '2.5'
      - task: ArtifactoryBuildPromotion@1
        inputs:
          artifactoryService: 'coles'
          buildName: 'cleanup'
          buildNumber: '2.5'
          targetRepo: 'jfrog-test'
          status: 'Released'
          sourceRepo: 'jfrog-source'
          includeDependencies: false
          copy: false
          dryRun: false
